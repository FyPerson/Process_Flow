# 连接线布局优化说明

## 功能概述

现在支持通过多种方式控制连接线，优化流程图布局：

### 1. **指定连接点（Handle）**

通过 `sourceHandle` 和 `targetHandle` 控制连接线的起点和终点位置。

```json
{
  "id": "conn_001",
  "sourceID": "node_001",
  "targetID": "node_002",
  "sourceHandle": "bottom", // top, bottom, left, right
  "targetHandle": "top"
}
```

### 2. **路径点（Waypoints）**

通过 `waypoints` 数组精确控制连接线的中间路径，避免交叉。

```json
{
  "id": "conn_002",
  "sourceID": "node_001",
  "targetID": "node_003",
  "waypoints": [
    { "x": 400, "y": 300 }, // 第一个转折点
    { "x": 500, "y": 300 }, // 第二个转折点
    { "x": 500, "y": 400 } // 第三个转折点
  ]
}
```

### 3. **连接线类型（Edge Type）**

通过 `edgeType` 选择不同的连接线样式。

- `smoothstep` - 圆角折线（默认，推荐）
- `step` - 直角折线
- `straight` - 直线

```json
{
  "id": "conn_003",
  "sourceID": "node_001",
  "targetID": "node_002",
  "edgeType": "smoothstep"
}
```

### 4. **连接线样式（Style）**

自定义连接线的颜色、粗细、虚线等。

```json
{
  "id": "conn_004",
  "sourceID": "node_001",
  "targetID": "node_002",
  "style": {
    "stroke": "#3b82f6", // 颜色
    "strokeWidth": 3, // 粗细
    "strokeDasharray": "5,5" // 虚线（可选）
  }
}
```

## 使用场景

### 场景1：避免连接线交叉

当两条连接线可能交叉时，使用路径点让其中一条绕行：

```json
{
  "id": "conn_avoid_cross",
  "sourceID": "node_A",
  "targetID": "node_B",
  "waypoints": [
    { "x": 400, "y": 200 }, // 向右绕行
    { "x": 600, "y": 200 },
    { "x": 600, "y": 400 } // 再向下
  ]
}
```

### 场景2：统一分支汇聚

让多个"否"分支汇聚到同一个结束节点：

```json
{
  "id": "conn_no_branch",
  "sourceID": "decision_node",
  "targetID": "end_node",
  "sourceHandle": "right",
  "targetHandle": "left",
  "waypoints": [
    { "x": 500, "y": 300 } // 统一向右再向下
  ]
}
```

### 场景3：长距离连接

对于距离较远的节点，使用路径点让连接线更清晰：

```json
{
  "id": "conn_long_distance",
  "sourceID": "node_start",
  "targetID": "node_end",
  "waypoints": [
    { "x": 400, "y": 100 }, // 先垂直向下
    { "x": 400, "y": 800 }, // 再水平向右
    { "x": 800, "y": 800 } // 最后垂直向上
  ]
}
```

## 最佳实践

1. **优先使用 Handle** - 简单场景只需指定连接点即可
2. **路径点要合理** - 路径点应该形成清晰的垂直/水平路径
3. **避免过度使用** - 只在必要时使用路径点，保持流程图简洁
4. **保持一致性** - 相同类型的连接线使用相同的样式

## 示例

查看 `public/data/business-flow.json` 中的连接线配置，了解实际应用。
