# 流程可视化优化说明

## 📋 优化内容

### 1. **简化流程节点**

- ✅ 只保留 3 个核心节点：
  - **是否中标**（判断节点）
  - **收入合同起拟**（处理节点）
  - **返还投标保证金**（处理节点）

### 1.1 **连接线逻辑优化**

- ✅ 符合判断节点的常规表达：
  - **左侧出口** → "中标" → 收入合同起拟
  - **右侧出口** → "未中标" → 返还投标保证金
- ✅ 避免了之前两条线都从底部出发的问题
- ✅ 连线路径更直接、更符合阅读习惯

### 2. **数据文件**

- 创建新的简化数据文件：`public/data/simple-flow.json`
- 包含完整的节点详情配置（数据库表信息）
- 定义清晰的连接关系和标签

### 3. **Dagre 自动布局优化**

- ✅ 更新节点尺寸配置：
  - 处理节点：200x80
  - 判断节点：160x160
  - 终止节点：120x60
- ✅ 优化布局参数：
  - 同级节点间距：200px
  - 不同层级间距：180px
  - 边距：150px (左右) / 120px (上下)
- ✅ 使用 `network-simplex` 算法获得更好的布局质量

### 4. **视觉美化**

#### 页面头部

- 渐变背景：深蓝 → 紫色调
- 标题使用渐变文字效果
- 添加副标题说明流程走向
- 信息卡片添加图标和悬停效果

#### 节点样式

- **判断节点**（菱形）：
  - 尺寸增大到 160x160
  - 渐变色：浅紫 → 深紫
  - 边框加粗到 4px
  - 内阴影和外阴影效果
  - 悬停时缩放 1.05 倍
- **处理节点**（圆角矩形）：
  - 尺寸增大到 200x80
  - 渐变色：蓝色系
  - 边框加粗到 3px
  - 多层阴影效果
  - 悬停时上移 4px 并缩放 1.02 倍

#### 连接线样式

- 线宽增加到 3px
- 箭头尺寸增加到 16x16
- 启用动画效果
- 标签背景半透明
- 标签文字加粗，字号 14px

#### 控制按钮

- 渐变紫色背景
- 多层阴影效果
- 悬停时上移和缩放
- 边框发光效果

#### 背景效果

- 多层渐变：深蓝 → 紫色 → 深蓝
- 点状网格，透明度 0.4
- 点间距 24px，点大小 1.5px

### 5. **交互优化**

- ✅ 缩放范围：0.5x - 2x
- ✅ 自动适配视图，padding 0.3
- ✅ 最大缩放限制 1.2x（防止过度放大）
- ✅ 连接线动画效果
- ✅ 节点悬停效果

## 🚀 使用方法

1. **启动项目**：

   ```bash
   双击 启动.bat
   # 或
   npm run dev
   ```

2. **访问页面**：
   - 打开浏览器访问：`http://localhost:5173`
   - 点击顶部导航栏的 **"流程可视化"** 按钮

3. **操作说明**：
   - 点击 **"📐 自动布局"** 按钮：使用 dagre 算法自动排列节点
   - 点击节点：查看详细信息（数据库表结构）
   - 拖拽画布：移动视图
   - 滚轮：缩放视图
   - 使用右侧控制面板：缩放、适配视图

## 📊 数据结构

### 节点配置

```json
{
  "id": "node_bid_decision",
  "name": "是否中标",
  "type": "decision",
  "expandable": true,
  "detailConfig": {
    "description": "判断投标结果，决定后续流程走向",
    "databaseTables": [...]
  }
}
```

### 连接线配置

```json
{
  "id": "conn_001",
  "sourceID": "node_bid_decision",
  "targetID": "node_contract_draft",
  "label": "中标",
  "style": {
    "stroke": "#10b981",
    "strokeWidth": 3
  }
}
```

## 🎨 配色方案

- **主背景**：深蓝 (#0f172a) → 紫色 (#312e81)
- **判断节点**：紫色系 (#8b5cf6 → #7c3aed)
- **处理节点**：蓝色系 (#3b82f6 → #1d4ed8)
- **中标连接线**：绿色 (#10b981)
- **未中标连接线**：红色 (#ef4444)
- **控制按钮**：紫色渐变 (#8b5cf6 → #7c3aed)

## 📝 技术栈

- **React 19** - UI 框架
- **React Flow 12** - 流程图库
- **Dagre** - 自动布局算法
- **TypeScript** - 类型安全
- **Vite** - 构建工具

## 🔧 自定义配置

### 修改节点数据

编辑 `public/data/simple-flow.json` 文件

### 调整布局参数

编辑 `src/utils/layout.ts` 中的 `NODE_SIZES` 和 `dagreGraph.setGraph()` 配置

### 修改样式

- 节点样式：`src/components/CustomNode/styles.css`
- 画布样式：`src/components/FlowCanvas/styles.css`
- 页面样式：`src/pages/BusinessFlowVisualization/styles.css`

---

**优化完成时间**：2025-11-28  
**版本**：v2.0
